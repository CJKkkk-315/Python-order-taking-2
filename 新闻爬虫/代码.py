import requests
from bs4 import BeautifulSoup
url = "https://baike.baidu.com/item/%E4%B8%AD%E5%9B%BD%E4%BA%BA%E5%8F%A3/4417422"
payload={}
headers = {
  'Connection': 'keep-alive',
  'sec-ch-ua': '" Not A;Brand";v="99", "Chromium";v="99", "Opera";v="85"',
  'sec-ch-ua-mobile': '?0',
  'sec-ch-ua-platform': '"Windows"',
  'Upgrade-Insecure-Requests': '1',
  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.84 Safari/537.36 OPR/85.0.4341.75',
  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
  'Sec-Fetch-Site': 'none',
  'Sec-Fetch-Mode': 'navigate',
  'Sec-Fetch-User': '?1',
  'Sec-Fetch-Dest': 'document',
  'Accept-Language': 'zh-CN,zh;q=0.9',
  'Cookie': 'zhishiTopicRequestTime=1652331462989; BAIDU_SSP_lcr=http://47.97.156.254/; zhishiTopicRequestTime=1647565753279; BAIKE_SHITONG=%7B%22data%22%3A%223c497d6ebf15c9b7451b63e6789231dfa2503b841e3a2501b67b8c542df1f95c38ddaa57d5928c969b2ae0186eeac9a532b26e5fb93d716abd0a86a39dec481c849f3caa664172dab2f0e581c4e604d2ccae559c9fa6fd87a10ed9e102b16d22%22%2C%22key_id%22%3A%2210%22%2C%22sign%22%3A%22e3a9ae85%22%7D; BIDUPSID=0182731BA22032B4F3602DFC4F424769; PSTM=1622972106; __yjs_duid=1_5d17d68c4166a5e32ccfea8edeb4abec1622977005912; BAIDUID=C5D6152DB31305B1E1DFC9336296AF6B:FG=1; BDUSS=tCYkV0US1aVjJweUw4N09QMTc5Umx4TXB0Q2pHZnFnelo5d1VxU3RjcDl-YmRoSVFBQUFBJCQAAAAAAQAAAAEAAADpIhs6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH1wkGF9cJBhZ0; BDUSS_BFESS=tCYkV0US1aVjJweUw4N09QMTc5Umx4TXB0Q2pHZnFnelo5d1VxU3RjcDl-YmRoSVFBQUFBJCQAAAAAAQAAAAEAAADpIhs6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH1wkGF9cJBhZ0; zhishiTopicRequestTime=1646194186918; BK_SEARCHLOG=%7B%22key%22%3A%5B%22%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%22%2C%22%E5%AE%A0%E7%89%A9%E7%8C%AB%22%2C%22%E9%9D%9E%E6%B4%B2%E4%BF%BE%E6%A0%BC%E7%B1%B3%E6%88%96%E5%87%A0%E5%86%85%E4%BA%9A%E7%8C%AA%22%2C%22%E8%83%A1%E5%88%A9%E4%BA%9A%E5%B0%BC%E7%8C%AA%22%2C%22%E8%B6%8A%E5%8D%97%E5%A4%A7%E8%82%9A%E7%8C%AA%22%2C%22%E6%8B%89%E5%B8%83%E6%8B%89%E5%A4%9A%E7%8A%AC%22%2C%22%E5%A5%A5%E6%96%AF%E8%90%A8%E5%B7%B4%E5%B2%9B%E7%8C%AA%22%2C%22%E5%AE%A0%E7%89%A9%E7%8C%AA%22%2C%22%E4%B8%AD%E5%8D%8E%E7%94%B0%E5%9B%AD%E7%8A%AC%22%2C%22%E8%90%A8%E6%91%A9%E8%80%B6%22%2C%22%E5%AE%A0%E7%89%A9%E7%8B%97%E7%A7%8D%E7%B1%BB%22%2C%22%E5%AE%A0%E7%89%A9%E7%8B%97%22%2C%22%E7%8B%97%22%2C%22%E6%B0%B4%E7%8C%8E%E7%8A%AC%22%2C%22%E4%BC%B4%E4%BE%A3%E7%8A%AC%22%2C%22%E8%A7%86%E7%8C%8E%E7%8A%AC%22%2C%22%E8%85%8A%E8%82%A0%E7%8A%AC%22%2C%22%E7%89%A7%E7%BE%8A%E7%8A%AC%22%2C%22%E6%A2%97%E7%8A%AC%22%2C%22%E5%B0%96%E5%98%B4%E5%8F%8A%E5%8E%9F%E5%A7%8B%E7%8A%AC%E7%B1%BB%22%5D%7D; MCITY=-%3A; BDSFRCVID=UckOJexroG0l3C5DfxBNoi5gbeKK0gOTDYrEOwXPsp3LGJLVcf13EG0PtfOEtU8MaXv6ogKK3mOTH6KF_2uxOjjg8UtVJeC6EG0Ptf8g0M5; H_BDCLCKID_SF=tRk8oK-atDvDqTrP-trf5DCShUFsWqJtB2Q-XPoO3KJCM-OnQM8-3j-eMeFe-h57HGPebxbgy4op8P3y0bb2DUA1y4vpKMJIBeTxoUJ2XhrPDfcoqtnWhfkebPRiJ-r9Qg-qahQ7tt5W8ncFbT7l5hKpbt-q0x-jLTnhVn0MBCK0hD0wDT8hD6PVKgTa54cbb4o2WbCQJb7M8pcN2b5oQT8wjhb20U0qQ6RyB6CbbMQ1Kf-R0qOUWJDkXpJvQnJjt2JxaqRC5hOG8l5jDh3MBUCzhJ6ie4ROamby0hvctb6cShPCyUjrDRLbXU6BK5vPbNcZ0l8K3l02V-bIe-t2XjQhDNtfJ5-HJR3EBnTeKRA_HRjYbb__-P4DeUJtyMRZ5m7C3R4EalnKOlb_bn_WMM0nMn3LBMPj52OnaIQd2poZqtKl-URmKj_T346OJ5o43bRTsxKy5KJvfj6_3URVhP-UyNbLWh37JPjlMKoaMp78jR093JO4y4Ldj4oxJpOJ5JbMopCafD8BMDP6e5uMenIJMqJK2t-X2IoeBnOEHJO_bnAGLUnkbfJBD4JHXUFJt2nh5tT82pb1jUJzjUvmQ5-7yajK2hjkbGvqofneLCTB8K3JKtrpQT8r-tFOK5Oibmjr04-bab3vOIOzXpO1jKuzBN5thURB2DkO-4bCWJ5TMl5jDh3Mb6ksDMDtqjt8fRFe_IPKfbo5KRopMtOhq4tehHRP5-n9WDTOQJ7Ttn45EI5ebR7IX44tjfJaKxnitIv9-pbw-q5cfUnMKn05XM-pXbj2Kj_e3mkjbPbDBh5MSDnE-q7-j44syP4e2xRnWnciKfA-b4ncjRcTehoM3xI8LNj405OTbIFO0KJzJCcjqR8Zj58KDTcP; BCLID_BFESS=9570399403665624143; BDSFRCVID_BFESS=UckOJexroG0l3C5DfxBNoi5gbeKK0gOTDYrEOwXPsp3LGJLVcf13EG0PtfOEtU8MaXv6ogKK3mOTH6KF_2uxOjjg8UtVJeC6EG0Ptf8g0M5; H_BDCLCKID_SF_BFESS=tRk8oK-atDvDqTrP-trf5DCShUFsWqJtB2Q-XPoO3KJCM-OnQM8-3j-eMeFe-h57HGPebxbgy4op8P3y0bb2DUA1y4vpKMJIBeTxoUJ2XhrPDfcoqtnWhfkebPRiJ-r9Qg-qahQ7tt5W8ncFbT7l5hKpbt-q0x-jLTnhVn0MBCK0hD0wDT8hD6PVKgTa54cbb4o2WbCQJb7M8pcN2b5oQT8wjhb20U0qQ6RyB6CbbMQ1Kf-R0qOUWJDkXpJvQnJjt2JxaqRC5hOG8l5jDh3MBUCzhJ6ie4ROamby0hvctb6cShPCyUjrDRLbXU6BK5vPbNcZ0l8K3l02V-bIe-t2XjQhDNtfJ5-HJR3EBnTeKRA_HRjYbb__-P4DeUJtyMRZ5m7C3R4EalnKOlb_bn_WMM0nMn3LBMPj52OnaIQd2poZqtKl-URmKj_T346OJ5o43bRTsxKy5KJvfj6_3URVhP-UyNbLWh37JPjlMKoaMp78jR093JO4y4Ldj4oxJpOJ5JbMopCafD8BMDP6e5uMenIJMqJK2t-X2IoeBnOEHJO_bnAGLUnkbfJBD4JHXUFJt2nh5tT82pb1jUJzjUvmQ5-7yajK2hjkbGvqofneLCTB8K3JKtrpQT8r-tFOK5Oibmjr04-bab3vOIOzXpO1jKuzBN5thURB2DkO-4bCWJ5TMl5jDh3Mb6ksDMDtqjt8fRFe_IPKfbo5KRopMtOhq4tehHRP5-n9WDTOQJ7Ttn45EI5ebR7IX44tjfJaKxnitIv9-pbw-q5cfUnMKn05XM-pXbj2Kj_e3mkjbPbDBh5MSDnE-q7-j44syP4e2xRnWnciKfA-b4ncjRcTehoM3xI8LNj405OTbIFO0KJzJCcjqR8Zj58KDTcP; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BA_HECTOR=25240k8581a50421t01h7p4mh0r; BAIDUID_BFESS=C5D6152DB31305B1E1DFC9336296AF6B:FG=1; delPer=0; PSINO=3; H_PS_PSSID=36429_31253_34812_36166_34584_35979_36055_36419_26350; Hm_lvt_55b574651fcae74b0a9f1cf9c8d7c93a=; Hm_lpvt_55b574651fcae74b0a9f1cf9c8d7c93a=1652331462; channel=baidusearch; baikeVisitId=bd9bf731-537e-4cac-8f50-b1e46c386ed5; ab_sr=1.0.1_N2U4MDUwYWY5ZDBjY2Y5MjI0ZTI4YWU1ZDI4MjExYjVhNzMwYTM5Y2IxNjJiNjI2NzMxZjVkYzA3OTcxYWEyYmQ5NWNlMzY4MmE3MmNiYmQxMjRjYmIxNjdiYTUzM2M5NzI1YWJlNjVhMDY2MTRmNzZlNzYyYTc3NTk0NGEzZDdmMzczZDc5M2IwMTNmMjVmMWMxYTNmZjQ3MzkzODExZDg4MjAwZTM1Zjc2ZjBiYjFkZjU0ZGQ2ZWQ3YTg1OWMy; RT="z=1&dm=baidu.com&si=zp03uyj7egs&ss=l32jhmjs&sl=4&tt=5ye&bcn=https%3A%2F%2Ffclog.baidu.com%2Flog%2Fweirwood%3Ftype%3Dperf&ld=adu&cl=8q2&ul=46hm"; BIDUPSID=312256540714E85667DE9A7D5301A2BD; PSTM=1623077232'
}
response = requests.request("GET", url, headers=headers, data=payload)
soup = BeautifulSoup(response.text)
l = []
for i in soup.find_all(name='table')[-1].find_all(name='tr')[2:]:
    city = i.find_all(name='td')[1].text
    number = i.find_all(name='td')[2].text
    l.append([city,int(number)])
import csv
with open('人口表格.csv','w',newline='') as f:
    fcsv = csv.writer(f)
    for i in l:
        fcsv.writerow(i)
import matplotlib.pyplot as plt
x = [i[0] for i in l]
y = [i[1] for i in l]
plt.rcParams['font.sans-serif']=['SimHei']
plt.pie(y,labels=x)
plt.show()
